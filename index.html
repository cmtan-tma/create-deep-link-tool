<html>

<head>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"
        integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">

</head>

<body>
    <div class="container">
        <h2 class="h1 text-center text-success mt-5">Create Deep Link Teams App</h2>
        <form>
            <div class="form-group row">
                <label for="appId">AppId</label>
                <input type="text" class="form-control" id="appId" placeholder="Get from App Studio">
            </div>

            <div class="form-group row">
                <label for="entityId">EntityId</label>
                <input type="text" class="form-control" id="entityId" placeholder="Get From Config Tab">
            </div>

            <div class="form-group row">
                <label for="webUrl">WebUrl</label>
                <input type="text" class="form-control" id="webUrl" placeholder="Any URL">
            </div>

            <div class="form-group row">
                <label for="label">Label</label>
                <input type="text" class="form-control" id="label" placeholder="Any label">
            </div>

            <div class="form-group row">
                <label for="channelId">ChannelId (Optional)</label>
                <input type="text" class="form-control" id="channelId" placeholder="Ignore if using Personal Tab">
            </div>

            <div class="form-group row">
                <label for="subEntityId">SubEntityId (Optional)</label>
                <input type="text" class="form-control" id="subEntityId" placeholder="Enter one-time URL here">
            </div>
        </form>
        <div>
            <h4>Encoded Url</h4>
            <button onclick="copy(urlElement); alert('Copied');" class="btn btn-success">Copy</button>
            <div>
                <a href="#" target="_blank" id="url"></a>
            </div>
        </div>
        <br>
        <div>
            <h4>unEncoded Url</h4>
            <button onclick="copy(rawElement); alert('Copied');" class="btn btn-success">Copy</button>
            <p id="rawUrl"></p>
        </div>
    </div>
    </div>
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
        integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js"
        integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js"
        integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
        crossorigin="anonymous"></script>
    <script>
        url = {
            protocol: "https",
            domain: "teams.microsoft.com/l/entity",
            appId: "",
            entityId: "",
            parameters: {
                webUrl: "",
                label: "",
                context: {
                    channelId: "",
                    subEntityId: ""
                }
            }
        }

        urlElement = document.getElementById("url");
        rawElement = document.getElementById("rawUrl");

        function url2Text(encode) {
            return `${url.protocol}://${url.domain}/${url.appId}/${url.entityId}/?webUrl=${encode(url.parameters.webUrl)}&label=${encode(url.parameters.label)}&context=${encode(JSON.stringify(url.parameters.context))}`
        }

        function encode(text) {
            return text
        }

        function displayUrl() {
            urlElement.innerText = url2Text(encodeURIComponent);
            rawElement.innerText = url2Text(encode);

            urlElement.setAttribute("href", url2Text(encodeURIComponent));
        }

        function copy(pElement) {
            navigator.clipboard.writeText(pElement.innerText)
        }

        displayUrl()


        appIdInputElement = document.getElementById("appId")
        appIdInputElement.addEventListener('input', () => {
            url.appId = appIdInputElement.value
            displayUrl()
        })

        entityIdInputElement = document.getElementById("entityId")
        entityIdInputElement.addEventListener('input', () => {
            url.entityId = entityIdInputElement.value
            displayUrl()
        })

        webUrlInputElement = document.getElementById("webUrl")
        webUrlInputElement.addEventListener('input', () => {
            url.parameters.webUrl = webUrlInputElement.value
            displayUrl()
        })

        labelInputElement = document.getElementById("label")
        labelInputElement.addEventListener('input', () => {
            url.parameters.label = labelInputElement.value
            displayUrl()
        })

        channelIdInputElement = document.getElementById("channelId")
        channelIdInputElement.addEventListener('input', () => {
            url.parameters.context.channelId = channelIdInputElement.value
            displayUrl()
        })

        subEntityIdInputElement = document.getElementById("subEntityId")
        subEntityIdInputElement.addEventListener('input', () => {
            url.parameters.context.subEntityId = subEntityIdInputElement.value
            displayUrl()
        })
    </script>
</body>

</html>